#!/usr/bin/python

#TO DO
#-recreate tree experiment
#-make answer file names unique
#-make form variables uniform across files
#-write generateQuestions?
#-print currentQuestionNumber/totalNumber
#-connect to mturk code
#-write question generator for trees and tug of war

import cgi, random, glob
from questions import loadQuestion, storePreviousQuestion, finalQuestionNumber

# def init():
#     questions = generateQuestions()
#     assignOrder!(questions)
#     storeOrder(questions,workerId)

def main():
    form = cgi.FieldStorage()

    if 'previousQuestionNumber' in form:
        previousQuestionNumber = int(form["previousQuestionNumber"].value)
        if previousQuestionNumber > 0:
            storePreviousQuestion(form["previousQuestionAnswer"].value, previousQuestionNumber)
        currentQuestionNumber = int(previousQuestionNumber)+1
    else:
	currentQuestionNumber = 0
#        init()

    question = loadQuestion(currentQuestionNumber)

    print "Content-type: text/html\n"
    print '<head>'
    print '<script type="text/javascript" src="support.js"></script>'
    print '<body>'

    #this will eventually be dependent on the question number
    if currentQuestionNumber < finalQuestionNumber:
        print '<form method="POST" action="Test.cgi">'
    else:
        print '<form method="POST" action="TestSubmit.cgi">'

    #eventually print currentQuestionNumber/totalNumber
    print str(currentQuestionNumber)+'/'+str(finalQuestionNumber)

    print question
    #the submitted question becomes the previous question answered
    print '<input type="hidden" name="previousQuestionNumber" value=', currentQuestionNumber, '>'
    
    if currentQuestionNumber == 0:
        print '<input type="submit" value="Agree">'
    else:
        print '<input type="submit" value="Submit HIT">'
    print '</form>'
    print '</body>'
main()

    
        
